(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{4768:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/settings",function(){return n(8438)}])},6771:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(5893),i=n(7294),o=n(1163),a=n(9008),s=n.n(a),c=n(8298),l=n(2734),u=n(2293),d=n(9520),p=n(155),f=n(6886),h=n(3321),y=n(5861),g=n(7357);function v(e){var t=e.children,n=(0,c.Z)({disableHysteresis:!0,threshold:24});return(0,i.cloneElement)(t,{elevation:n?4:0})}var m=function(){var e=(0,i.useState)(!1),t=e[0],n=e[1],o=((0,i.useCallback)((function(){n(!t)}),[t]),(0,l.Z)());return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(v,{children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{color:"transparent",elevation:0,children:(0,r.jsx)(d.Z,{maxWidth:"xl",sx:{padding:0},children:(0,r.jsx)(p.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,r.jsx)(f.ZP,{item:!0,children:(0,r.jsx)(h.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,r.jsx)(y.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:o.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,r.jsx)(g.Z,{sx:{height:o.spacing(18)}})]})})})};function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){b(e,t,n[t])}))}return e}var j=!1;var w=function(e){var t=(0,o.useRouter)();return(0,i.useEffect)((function(){if(t.isReady&&!j){var e,n,r,i;j=!0;var o=(null===(e=t.query)||void 0===e?void 0:e.apiKey)||"",a=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",s=!1;if((null===(r=t.query)||void 0===r?void 0:r.apiKey)||(s=!0,o=window.prompt("Please enter your API key",o)),(null===(i=t.query)||void 0===i?void 0:i.apiPort)||(s=!0,a=window.prompt("Please enter your API port (default: 9170)",a)),s&&o&&a){var c=t.asPath.split("?")[0];t.replace({pathname:c.includes(".html")?c:"".concat(c,".html"),query:x({},t.query,{apiKey:o,apiPort:a})})}}}),[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(s(),{children:[(0,r.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("link",{rel:"canonical",href:e.url}),(0,r.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,r.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,r.jsx)(m,{}),e.children]})}},9375:function(e,t,n){"use strict";n.d(t,{C:function(){return s}});var r=n(4051),i=n.n(r);function o(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,i)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function s(e){o(a,r,i,s,c,"next",e)}function c(e){o(a,r,i,s,c,"throw",e)}s(void 0)}))}}var s=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.port=t||9170,this.apiKey=n;var o=this;a(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.connect();case 2:o.websocket=e.sent,r&&o.websocket&&o.websocket.readyState===o.websocket.OPEN&&r();case 4:case"end":return e.stop()}}),e)})))()}var t=e.prototype;return t.close=function(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()},t.connect=function(){var e=this;return a(i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(e.port,"/api/websocket")),t.next=3,new Promise((function(e){n.onopen=function(){return e()}}));case 3:return n.onmessage=function(t){if("string"===typeof t.data){var n=JSON.parse(t.data);n&&e.onEvent&&e.onEvent(n)}},t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()},t.getData=function(e){this.websocket&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({event:"GET_DATA","api-key":this.apiKey,modules:e})))},t.getSettings=function(){this.websocket&&(console.log("Get settings"),this.websocket.send(JSON.stringify({event:"GET_SETTINGS","api-key":this.apiKey})))},t.registerDataListener=function(e){this.websocket&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({event:"REGISTER_DATA_LISTENER","api-key":this.apiKey,modules:e})))},t.sendEvent=function(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({event:"events",data:{"api-key":this.apiKey,data:e}}))},t.updateSetting=function(e,t){this.websocket&&(console.log("Update setting:",{key:e,value:t}),this.websocket.send(JSON.stringify({event:"UPDATE_SETTING","api-key":this.apiKey,setting:e,value:t})))},e}()},8438:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var r=n(5893),i=n(7294),o=n(9520),a=n(6771),s=n(4051),c=n.n(s),l=n(2734),u=n(6886),d=n(8456),p=n(1163),f=n(5317),h=n(7262),y=n(9375),g=n(5934),v=n(9875),m=n(796),b=n(9953),x=n(3395),j=n(9653),w=n(4054),k=n(7709),S=n(7109),P=n(3946),Z=n(1713),O=n(699),E=n(8849);function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){var t=e.keyIn,n=e.valueIn,o=e.handleChanged,a=function(e){I(e)},s=function(e){a(e.target.value)},c=(0,i.useState)(!1),d=c[0],p=c[1],h=(0,i.useState)(n),y=h[0],I=h[1],N=(0,i.useMemo)((function(){return n!==y}),[n,y]),T=q[t],A=T.name,_=T.description,G=T.icon,D=T.containerDisabled,K=T.isPassword,R=T.minimum,W=(0,l.Z)();return(0,r.jsxs)(v.ZP,{children:[(0,r.jsx)(m.Z,{children:(0,r.jsx)(E.Icon,{id:"icon",title:A,size:1,path:G})}),(0,r.jsx)(b.Z,{style:{maxWidth:"64%"},primary:A,secondary:_,sx:{userSelect:"none"}}),(0,r.jsx)(x.Z,{sx:{width:420,textAlign:"end"},children:(0,r.jsxs)(u.ZP,{container:!0,alignItems:"center",justifyContent:"flex-end",children:[(0,r.jsx)(u.ZP,{item:!0,children:"boolean"===typeof y?(0,r.jsx)(j.Z,{edge:"end",disabled:D,checked:y,onChange:function(e,t){a(t)}}):"string"===typeof y&&"api_key"===t?(0,r.jsx)(w.Z,{fullWidth:!0,variant:"outlined",children:(0,r.jsx)(k.Z,{type:"text",disabled:!0,value:y,endAdornment:(0,r.jsxs)(S.Z,{position:"end",children:[(0,r.jsx)(P.Z,{"aria-label":"Generate Api Key",onClick:function(){a((0,g.Z)())},edge:"end",size:"large",sx:{margin:W.spacing(-1,-.5)},children:(0,r.jsx)(E.Icon,{id:"generate-api-key",title:"Generate API Key",size:1,path:f.VmU})}),(0,r.jsx)(P.Z,{"aria-label":"Copy to clipboard",onClick:function(){return e=y,void navigator.permissions.query({name:"clipboard-write"}).then((function(t){"granted"!==t.state&&"prompt"!==t.state||navigator.clipboard.writeText(e)}));var e},size:"large",sx:{margin:W.spacing(-1,-.5)},children:(0,r.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:f.a0Z})})]})})}):"string"===typeof y&&"log_level"===t?(0,r.jsx)(Z.Z,{id:t,options:["DEBUG","INFO","WARNING","ERROR","CRITICAL"],renderInput:function(e){return(0,r.jsx)(O.Z,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}({},e,{variant:"outlined"}))},onChange:function(e,t){t&&a(t)},sx:{width:210},value:y}):"string"===typeof y&&K?(0,r.jsx)(w.Z,{variant:"outlined",children:(0,r.jsx)(k.Z,{type:d?"text":"password",defaultValue:y,onChange:s,endAdornment:(0,r.jsx)(S.Z,{position:"end",children:(0,r.jsx)(P.Z,{"aria-label":"Toggle visibility",onClick:function(){p(!d)},onMouseDown:function(e){e.preventDefault()},size:"large",children:(0,r.jsx)(E.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:d?f.rgx:f.DqW})})})})}):"string"===typeof y?(0,r.jsx)(O.Z,{type:"text",defaultValue:y,disabled:D,onChange:s,variant:"outlined"}):"number"===typeof y?(0,r.jsx)(O.Z,{error:!!R&&y<R,type:"number",disabled:D,inputProps:{minimum:R},defaultValue:y,onChange:s,variant:"outlined"}):""}),(0,r.jsx)(u.ZP,{item:!0,children:(0,r.jsx)(P.Z,{disabled:!1===N,onClick:function(){o(t,y)},sx:{margin:W.spacing(1)},children:(0,r.jsx)(E.Icon,{id:"save",title:"Save",size:1,path:f.JTj,style:{opacity:N?1:.25}})})})]})})]})},N=n(5861),T=n(5113),A=n(8462);var _,G=function(e){var t=e.name,n=e.description,i=e.children;return(0,r.jsxs)(u.ZP,{container:!0,direction:"row",item:!0,xs:12,children:[(0,r.jsxs)(u.ZP,{item:!0,xs:4,style:{userSelect:"none"},children:[(0,r.jsx)(N.Z,{component:"h3",variant:"h5",children:t}),(0,r.jsx)(N.Z,{variant:"subtitle1",children:n})]}),(0,r.jsx)(u.ZP,{item:!0,xs:8,children:(0,r.jsx)(T.Z,{children:(0,r.jsx)(A.Z,{children:i})})})]})};function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function K(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,i)}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(c){s=!0,i=c}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q={autostart:{name:"Autostart",description:"Automatically start the application on startup",icon:f.USr},log_level:{name:"Log Level",description:"Log level for the application",icon:f.eLz},port_api:{name:"API Port",description:"Port for the API and WebSocket",icon:f.A0p}};var z=function(){var e=W((0,h.r)(),2),t=e[0],n=e[1],o=(0,i.useState)(!1),a=o[0],s=o[1],f=(0,p.useRouter)().query,g=(0,i.useCallback)((function(e){if(console.log("Event:",e),"SETTINGS_RESULT"===e.type){console.log("Settings result:",e.data);var t={};console.log("settingsMap:",q);var r=Object.keys(q);e.data.sort((function(e,t){return r.indexOf(e.key)>r.indexOf(t.key)?1:-1})).forEach((function(e){"boolean"===typeof e.value||Number.isNaN(Number(e.value))?"True"===e.value||"False"===e.value?t[e.key]="True"===e.value:t[e.key]=e.value:t[e.key]=Number(e.value)})),console.log("Settings:",t),n(t)}}),[n]),v=(0,i.useCallback)((function(e,t){var n;console.log("Setup WebSocketConnection"),_=new y.C(e,t,(n=c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.getSettings();case 1:case"end":return e.stop()}}),e)})),function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){K(o,r,i,a,s,"next",e)}function s(e){K(o,r,i,a,s,"throw",e)}a(void 0)}))})),_.onEvent=g}),[g]),m=(0,i.useCallback)((function(e,r){_.updateSetting(e,r),n(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){R(e,t,n[t])}))}return e}({},t,R({},e,r)))}),[t,n]);(0,i.useEffect)((function(){!a&&f&&f.apiKey&&(s(!0),v(Number(f.apiPort)||9170,String(f.apiKey)))}),[a,v,f]);var b=(0,l.Z)();return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(u.ZP,{container:!0,direction:"column",spacing:2,alignItems:"stretch",sx:{marginBottom:b.spacing(8),padding:b.spacing(2)},children:t?(0,r.jsx)(G,{name:"General",description:"General settings",children:(0,r.jsx)(r.Fragment,{children:Object.keys(t).map((function(e,n){return(0,r.jsx)(I,{keyIn:e,valueIn:t[e],handleChanged:m},n)}))})}):(0,r.jsx)(u.ZP,{container:!0,direction:"row",justifyContent:"center",sx:{margin:b.spacing(2,0,10)},children:(0,r.jsx)(d.Z,{})})})})};var B=function(){return(0,r.jsx)(a.Z,{title:"Settings",url:"https://system-bridge.timmo.dev",description:"Frontend for System Bridge",children:(0,r.jsx)(o.Z,{component:"article",maxWidth:"xl",children:(0,r.jsx)(z,{})})})}}},function(e){e.O(0,[702,538,316,699,713,257,244,774,888,179],(function(){return t=4768,e(e.s=t);var t}));var t=e.O();_N_E=t}]);