(self.webpackChunkogdf_python_widget=self.webpackChunkogdf_python_widget||[]).push([[568],{568:(t,e,n)=>{t.exports=n(374),t.exports.version=n(147).version},374:(t,e,n)=>{let i=n(337),r=n(431),s=n(226);n(840);let o=i.DOMWidgetModel.extend({defaults:r.extend(i.DOMWidgetModel.prototype.defaults(),{_model_name:"WidgetModel",_view_name:"WidgetView",_model_module:"ogdf-python-widget",_view_module:"ogdf-python-widget",_model_module_version:"0.1.0",_view_module_version:"0.1.0",width:960,height:540,x_pos:0,y_pos:0,zoom:1,click_thickness:10,animation_duration:1e3,force_config:null,rescale_on_resize:!0})}),l=i.DOMWidgetView.extend({initialize:function(t){l.__super__.initialize.call(this,t),this.isNodeMovementEnabled=this.model.get("node_movement_enabled"),this.isTransformCallbackAllowed=!0,this.forceDirected=!1,this.clickThickness=this.model.get("click_thickness"),this.animationDuration=this.model.get("animation_duration"),this.gridSize=this.model.get("grid_size"),this.nodes=[],this.links=[],this.clusters=[],this.width=this.model.get("width"),this.height=this.model.get("height"),this.model.on("msg:custom",this.handle_msg.bind(this)),this.model.on("change:x_pos",this.transformCallbackCheck,this),this.model.on("change:y_pos",this.transformCallbackCheck,this),this.model.on("change:zoom",this.transformCallbackCheck,this),this.model.on("change:width",this.svgSizeChanged,this),this.model.on("change:height",this.svgSizeChanged,this),this.model.on("change:click_thickness",this.clickThicknessChanged,this),this.model.on("change:animation_duration",this.animationDurationChanged,this),this.model.on("change:grid_size",this.gridSizeChanged,this),this.model.on("change:force_config",this.forceConfigChanged,this),this.model.on("change:node_movement_enabled",this.nodeMovementChanged,this),this.ticksSinceSync=0,this.send({code:"widgetReady"})},startForceLayout:function(t){let e=this;this.forceDirected=!0,s.select(this.svg).selectAll(".node").remove(),s.select(this.svg).selectAll("text").remove(),s.select(this.svg).selectAll(".line").remove();for(let t=0;t<this.links.length;t++)this.constructForceLink(this.links[t],this.line_holder,this,!1);let n=Object.values(this.nodes);for(let t=0;t<n.length;t++)this.constructNode(n[t],this.node_holder,this.text_holder,this,!1);setTimeout((function(){e.rescaleAllText()}),10),this.simulation=s.forceSimulation().nodes(n).on("end",(function(){e.syncBackend()}));let i=s.forceLink(this.links).id((function(t){return t.id})),r=s.forceManyBody().strength(t.chargeForce),o=s.forceCenter(t.forceCenterX,t.forceCenterY);this.simulation.force("charge_force",r).force("center_force",o).force("links",i),this.simulation.on("tick",(function(){s.select(e.svg).selectAll(".node").attr("x",(function(t){return t.x-t.nodeWidth/2})).attr("y",(function(t){return t.y-t.nodeHeight/2})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})),s.select(e.svg).selectAll(".nodeLabel").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})),s.select(e.svg).selectAll(".line").attr("d",(function(t){return e.getPathForLine(t.source.x,t.source.y,[],t.target.x,t.target.y,t.t_shape,t.source.id,t.target.id)})),e.ticksSinceSync%5==0&&(e.syncBackend(),e.ticksSinceSync=0)})),t.fixStartPosition&&s.select(this.svg).selectAll(".node").attr("x",(function(t){t.fx=t.x,t.fy=t.y}))},stopForceLayout:function(){this.forceDirected&&(this.forceDirected=!1,null!=this.simulation&&(this.simulation.stop(),this.simulation=null))},forceConfigChanged:function(){let t=this.model.get("force_config");t.stop||null==t.stop?this.stopForceLayout():this.startForceLayout(t)},nodeMovementChanged:function(){this.isNodeMovementEnabled=this.model.get("node_movement_enabled"),this.isNodeMovementEnabled?(s.select(this.svg).selectAll(".node").call(this.node_drag_handler),s.select(this.svg).selectAll(".nodeLabel").call(this.node_drag_handler)):(s.select(this.svg).selectAll(".node").on("mousedown.drag",null),s.select(this.svg).selectAll(".nodeLabel").on("mousedown.drag",null))},syncBackend:function(){this.send({code:"positionUpdate",nodes:this.nodes})},animationDurationChanged:function(){this.animationDuration=this.model.get("animation_duration")},gridSizeChanged:function(){this.gridSize=this.model.get("grid_size")},clickThicknessChanged:function(){this.clickThickness=this.model.get("click_thickness");let t=this;s.select(this.svg).selectAll(".line_click_holder > .line").attr("stroke-width",(function(e){return Math.max(e.strokeWidth,t.clickThickness)}))},svgSizeChanged:function(){this.width=this.model.get("width"),this.height=this.model.get("height"),s.select(this.svg).attr("width",this.model.get("width")).attr("height",this.model.get("height")),this.model.get("rescale_on_resize")&&this.readjustZoomLevel(this.getInitialTransform(15))},getInitialTransform:function(t){let e=Object.values(this.nodes),n=this.getBoundingBox(e,this.links),i=n.maxX-n.minX+2*t,r=n.maxY-n.minY+2*t;if(this.isClusterGraph){let t=this.clusters[this.rootClusterId];i=Math.max(i,t.x2-t.x),r=Math.max(r,t.y2-t.y)}let o=Math.min(this.width/i,this.height/r),l=this.width/2-(n.minX+i/2-t)*o,d=this.height/2-(n.minY+r/2-t)*o;return 1===e.length&&(o=1,l=this.width/2-e[0].x,d=this.height/2-e[0].y),s.zoomIdentity.translate(l,d).scale(o)},readjustZoomLevel:function(t){const e=this,n=s.select(this.svg),i=s.zoom();n.call(i.transform,t),n.call(i.on("zoom",(function({transform:t}){e.g.attr("transform",t)})).on("end",(function({transform:t}){e.updateZoomLevelInModel(t)}))),n.call(i),this.g.attr("transform",t),this.updateZoomLevelInModel(t)},updateZoomLevelInModel:function(t){this.isTransformCallbackAllowed=!1,this.model.set("x_pos",t.x),this.model.set("y_pos",t.y),this.model.set("zoom",t.k),this.model.save_changes(),this.isTransformCallbackAllowed=!0},transformCallbackCheck:function(){this.isTransformCallbackAllowed&&this.readjustZoomLevel(s.zoomIdentity.translate(this.model.get("x_pos"),this.model.get("y_pos")).scale(this.model.get("zoom")))},handle_msg:function(t){"clearGraph"===t.code?this.clearGraph():"initGraph"===t.code?(this.links=t.links,this.nodes=t.nodes,this.clusters=t.clusters,this.rootClusterId=t.rootClusterId,this.isClusterGraph="-1"!==this.rootClusterId,this.render()):"nodeAdded"===t.code?this.addNode(t.data):"linkAdded"===t.code?this.addLink(t.data):"addClusterById"===t.code?(this.addCluster(t.data),console.log(this.clusters)):"deleteNodeById"===t.code?this.deleteNodeById(t.data):"deleteLinkById"===t.code?this.deleteLinkById(t.data):"deleteClusterById"===t.code?(this.deleteClusterById(t.data),console.log(this.clusters)):"updateNode"===t.code?this.updateNode(t.data,t.animated):"updateLink"===t.code?this.updateLink(t.data,t.animated):"moveLink"===t.code?this.moveLinkBends(t.data):"removeAllBendMovers"===t.code?this.removeAllBendMovers():"removeBendMoversFor"===t.code?this.removeBendMoversForLink(t.data):"moveCluster"===t.code?this.moveCluster(t.data):"removeAllClusterMovers"===t.code?this.removeAllClusterMovers():"downloadSvg"===t.code?this.downloadSvg(t.fileName):"test"===t.code?this.moveCluster("2"):console.log("msg cannot be read: "+t)},downloadSvg:function(t){let e=this.svg.outerHTML;e.match(/^<svg[^>]+xmlns="http:\/\/www\.w3\.org\/2000\/svg"/)||(e=e.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),e.match(/^<svg[^>]+"http:\/\/www\.w3\.org\/1999\/xlink"/)||(e=e.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"'));const n=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=t+".svg",r.click()},moveCluster:function(t){let e=this,n=this.clusters[t],i=[{id:n.id,x:(n.x+n.x2)/2,y:(n.y+n.y2)/2,strokeWidth:1}],r=this.clusterMover_holder.data(i).enter().append("circle").attr("class","clusterMover").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("id",(function(t){return t.id})).attr("r",15).attr("fill","yellow").attr("stroke","black").attr("stroke-width",(function(t){return t.strokeWidth}));const o=s.drag().on("start",(function(t,n){s.select(e.svg).selectAll(".clusterMover").filter((function(t){return t.id===n.id})).attr("stroke-width",(function(t){return t.strokeWidth+1})),n.lastX=t.x,n.lastY=t.y})).on("drag",(function(t,n){const i=n.id,r=e.clusters[i];s.select(e.svg).selectAll(".clusterMover").filter((function(t){return t.id===i})).attr("cx",t.x).attr("cy",t.y),r.nodesBoundingBox.minX=r.nodesBoundingBox.minX-(n.lastX-t.x),r.nodesBoundingBox.maxX=r.nodesBoundingBox.maxX-(n.lastX-t.x),r.nodesBoundingBox.minY=r.nodesBoundingBox.minY-(n.lastY-t.y),r.nodesBoundingBox.maxY=r.nodesBoundingBox.maxY-(n.lastY-t.y),e.constructClusters(e.rootClusterId,!1);for(let i=0;i<r.nodes.length;i++){let s=e.nodes[r.nodes[i]];e.moveNodeAndLinks(s.id,s.x-(n.lastX-t.x),s.y-(n.lastY-t.y),s)}n.lastX=t.x,n.lastY=t.y})).on("end",(function(t,n){const i=e.clusters[n.id];s.select(e.svg).selectAll(".clusterMover").attr("stroke-width",(function(t){return t.strokeWidth})),n.x=t.x,n.y=t.y;for(let t=0;t<i.nodes.length;t++){let n=e.nodes[i.nodes[t]];e.send({code:"nodeMoved",id:n.id,x:n.x,y:n.y})}}));r.call(o)},moveLinkBends:function(t){let e=this,n=[];for(let e=0;e<t.bends.length;e++)n.push({id:t.id,x:t.bends[e][0],y:t.bends[e][1],bendIndex:e,strokeWidth:1});let i=this.bendMover_holder.data(n).enter().append("circle").attr("class","bendMover").attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("id",(function(t){return t.id})).attr("r",7).attr("fill","yellow").attr("stroke","black").attr("stroke-width",(function(t){return t.strokeWidth}));const r=s.drag().on("start",(function(t,n){s.select(e.svg).selectAll(".bendMover").filter((function(t){return t.id===n.id&&t.bendIndex===n.bendIndex})).attr("stroke-width",(function(t){return t.strokeWidth+1}))})).on("drag",(function(t,n){const i=n.id,r=n.bendIndex;s.select(e.svg).selectAll(".bendMover").filter((function(t){return t.id===i&&t.bendIndex===r})).attr("cx",t.x).attr("cy",t.y),s.select(e.svg).selectAll(".line").filter((function(t){return t.id===i})).attr("d",(function(n){return n.bends[r][0]=t.x,n.bends[r][1]=t.y,e.getPathForLine(n.sx,n.sy,n.bends,n.tx,n.ty,n.t_shape,n.source,n.target)})),0===r&&s.select(e.svg).selectAll(".linkLabel").filter((function(t){return t.id===i})).attr("transform",(function(){return"translate("+t.x+","+t.y+")"}))})).on("end",(function(t,n){s.select(e.svg).selectAll(".bendMover").attr("stroke-width",(function(t){return t.strokeWidth})),n.x!==t.x||n.y!==t.y?(n.x=Math.round(t.x),n.y=Math.round(t.y),e.send({code:"bendMoved",linkId:this.id,bendIndex:n.bendIndex,x:n.x,y:n.y})):e.send({code:"bendClicked",linkId:this.id,bendIndex:n.bendIndex,altKey:t.sourceEvent.altKey})}));i.call(r)},addNode:function(t){if(this.forceDirected&&this.stopForceLayout(),this.nodes[t.id]=t,this.constructNode(t,this.node_holder,this.text_holder,this,!1),this.isClusterGraph){const e=this.clusters[t.clusterId];e.nodes.push(t.id),this.recalculateClusterBoundingBox(e),this.constructClusters(this.rootClusterId,!1)}this.forceConfigChanged()},addLink:function(t){this.forceDirected&&this.stopForceLayout(),this.links.push(t),this.constructLink(t,this.line_holder,this.line_text_holder,this.line_click_holder,this,this.clickThickness,!1),this.forceConfigChanged()},addCluster:function(t){this.clusters[t.id]=t,this.clusters[t.parentId].children.push(t.id);for(let e=0;e<t.nodes.length;e++){let n=t.nodes[e],i=this.clusters[this.nodes[n].clusterId];i.nodes.splice(i.nodes.indexOf(n),1),this.nodes[n].clusterId=t.id}this.constructClusters(this.rootClusterId)},deleteNodeById:function(t){if(this.forceDirected&&this.stopForceLayout(),this.isClusterGraph){const e=this.clusters[this.nodes[t].clusterId];e.nodes.splice(e.nodes.indexOf(t),1),this.recalculateClusterBoundingBox(e),this.constructClusters(this.rootClusterId,!1)}delete this.nodes[t],s.select(this.svg).selectAll(".node").filter((function(e){return e.id===t})).remove(),s.select(this.svg).selectAll(".nodeLabel").filter((function(e){return e.id===t})).remove(),this.forceConfigChanged()},deleteLinkById:function(t){this.forceDirected&&this.stopForceLayout();for(let e=this.links.length-1;e>=0;e--)this.links[e].id===t&&this.links.splice(e,1);this.removeBendMoversForLink(t),s.select(this.svg).selectAll(".line").filter((function(e){return e.id===t})).remove(),s.select(this.svg).selectAll(".linkLabel").filter((function(e){return e.id===t})).remove(),this.forceConfigChanged()},deleteClusterById:function(t){if(this.rootClusterId===t)return void console.error("You cannot delete the root cluster!");let e=this.clusters[t],n=this.clusters[e.parentId];const i=n.children.indexOf(t);i>-1&&n.children.splice(i,1);for(let t=0;t<e.nodes.length;t++)this.nodes[e.nodes[t]].clusterId=n.id;n.children=n.children.concat(e.children),n.nodes=n.nodes.concat(e.nodes),n.nodesBoundingBox.minX=Math.min(n.nodesBoundingBox.minX,e.nodesBoundingBox.minX),n.nodesBoundingBox.maxX=Math.max(n.nodesBoundingBox.maxX,e.nodesBoundingBox.maxX),n.nodesBoundingBox.minY=Math.min(n.nodesBoundingBox.minY,e.nodesBoundingBox.minY),n.nodesBoundingBox.maxY=Math.max(n.nodesBoundingBox.maxY,e.nodesBoundingBox.maxY),this.calculateClusterSize(this.clusters[e.parentId]);for(let t=0;t<e.children.length;t++)this.clusters[e.children[t]].parentId=e.parentId;delete this.clusters[t],s.select(this.svg).selectAll(".cluster").filter((function(e){return e.id===t})).remove(),this.constructClusters(this.rootClusterId,!1)},updateNode:function(t,e){let n=this,i=s.select(this.svg).selectAll(".node").filter((function(e){return e.id===t.id})),r=s.select(this.svg).selectAll(".nodeLabel").filter((function(e){return e.id===t.id}));if(n.forceDirected&&n.simulation.alphaTarget(.3).restart(),i.transition().duration(e?this.animationDuration:1).attr("width",(function(e){return e.nodeWidth=t.nodeWidth,e.nodeWidth})).attr("height",(function(e){return e.nodeHeight=t.nodeHeight,e.nodeHeight})).attr("x",(function(e){if(n.forceDirected&&!n.isNodeMovementEnabled)e.fx=t.x;else if(n.forceDirected)return;return e.x=t.x,e.x-e.nodeWidth/2})).attr("y",(function(e){if(n.forceDirected&&!n.isNodeMovementEnabled)e.fy=t.y;else if(n.forceDirected)return;return e.y=t.y,e.y-e.nodeHeight/2})).attr("cx",(function(e){if(n.forceDirected&&!n.isNodeMovementEnabled)e.fx=t.x;else if(n.forceDirected)return;return e.x=t.x,e.x})).attr("cy",(function(e){if(n.forceDirected&&!n.isNodeMovementEnabled)e.fy=t.y;else if(n.forceDirected)return;return e.y=t.y,e.y})).attr("r",(function(e){return e.nodeHeight=t.nodeHeight,e.nodeHeight/2})).attr("fill",(function(e){return e.fillColor=t.fillColor,n.getColorStringFromJson(e.fillColor)})).attr("stroke",(function(e){return e.strokeColor=t.strokeColor,n.getColorStringFromJson(e.strokeColor)})).attr("stroke-width",(function(e){return e.strokeWidth=t.strokeWidth,e.strokeWidth})),this.isClusterGraph){const e=this.clusters[t.clusterId];this.recalculateClusterBoundingBox(e),this.constructClusters(this.rootClusterId,!1)}n.forceDirected&&setTimeout((function(){n.simulation.alphaTarget(0)}),1e3);let o=!0;r.text((function(e){return e.name!==t.name?e.name=t.name:o=!1,e.name})),o&&setTimeout((function(){n.rescaleTextById(t.id)}),10),r.transition().duration(e?this.animationDuration:1).attr("transform",(function(e){if(!n.forceDirected||!n.isNodeMovementEnabled)return e.x=t.x,e.y=t.y,"translate("+e.x+","+e.y+")"}))},addBendsToLink:function(t,e){let n=[[t.sx,t.sy]].concat(t.bends).concat([[t.tx,t.ty]]);for(;e>n.length-2;)for(let t=n.length-2;t>=0&&e>n.length-2;t--){let e=[(n[t][0]+n[t+1][0])/2,(n[t][1]+n[t+1][1])/2];n.splice(t+1,0,e)}return n.shift(),n.pop(),t.bends=n,t},updateLink:function(t,e){let n,i=!1;if(s.select(this.svg).selectAll(".bendMover").filter((function(e){return e.id===t.id&&(i=!0),e.id===t.id})).remove(),i&&this.moveLinkBends(t),!e)return this.deleteLinkById(t.id),void this.addLink(t);for(let e=this.links.length-1;e>=0;e--)this.links[e].id===t.id&&(n=this.links[e]);let r=null;null!==n&&n.bends.length!==t.bends.length&&(n.bends.length<t.bends.length?(this.deleteLinkById(t.id),this.addLink(this.addBendsToLink(JSON.parse(JSON.stringify(n)),t.bends.length))):r=this.addBendsToLink(JSON.parse(JSON.stringify(t)),n.bends.length));let o=this,l=s.select(this.svg).selectAll(".line_holder > .line").filter((function(e){return e.id===t.id})),d=s.select(this.svg).selectAll(".line_click_holder > .line").filter((function(e){return e.id===t.id})),a=s.select(this.svg).selectAll(".linkLabel").filter((function(e){return e.id===t.id}));l.transition().duration(this.animationDuration).attr("d",(function(e){let n=null==r?t:r;return e.sx=n.sx,e.sy=n.sy,e.bends=n.bends,e.tx=n.tx,e.ty=n.ty,o.getPathForLine(e.sx,e.sy,e.bends,e.tx,e.ty,e.t_shape,e.source,e.target)})).attr("stroke",(function(e){return e.strokeColor=t.strokeColor,o.getColorStringFromJson(e.strokeColor)})).attr("stroke-width",(function(e){return e.strokeWidth=t.strokeWidth,e.strokeWidth})),d.transition().duration(this.animationDuration).attr("d",(function(e){return e.sx=t.sx,e.sy=t.sy,e.bends=t.bends,e.tx=t.tx,e.ty=t.ty,o.getPathForLine(e.sx,e.sy,e.bends,e.tx,e.ty,e.t_shape,e.source,e.target)})).attr("stroke-width",(function(e){return e.strokeWidth=t.strokeWidth,Math.max(e.strokeWidth,o.clickThickness)})),a.transition().duration(this.animationDuration).text((function(e){return e.label=t.label,e.label})).attr("transform",(function(e){return e.label_x=t.label_x,e.label_y=t.label_y,"translate("+e.label_x+","+e.label_y+")"})),null!=r&&setTimeout((()=>{this.deleteLinkById(t.id),this.addLink(t)}),this.animationDuration)},updateCluster:function(t,e){let n=this,i=s.select(this.svg).selectAll(".cluster").filter((function(e){return e.id===t.id}));if(null==i)return void console.error("ClusterId: "+t.id+" could not be found.");const r=s.line();i.transition().duration(e?this.animationDuration:1).attr("d",(function(t){let e=[[t.x,t.y],[t.x2,t.y],[t.x2,t.y2],[t.x,t.y2],[t.x,t.y]];return r(e)})).attr("stroke",(function(t){return n.getColorStringFromJson(t.strokeColor)})).attr("stroke-width",(function(t){return t.strokeWidth})).attr("fill","none")},clearGraph:function(){this.nodes={},this.links=[],s.select(this.svg).selectAll(".node").remove(),s.select(this.svg).selectAll("text").remove(),s.select(this.svg).selectAll(".line").remove()},getBoundingBox:function(t,e){let n={minX:Number.MAX_VALUE,maxX:Number.MIN_VALUE,minY:Number.MAX_VALUE,maxY:Number.MIN_VALUE};for(let e=0;e<t.length;e++)t[e].x<n.minX&&(n.minX=t[e].x),t[e].x>n.maxX&&(n.maxX=t[e].x),t[e].y<n.minY&&(n.minY=t[e].y),t[e].y>n.maxY&&(n.maxY=t[e].y);if(null!=e)for(let t=0;t<e.length;t++)for(let i=0;i<e[t].bends.length;i++){let r=e[t].bends[i];r[0]<n.minX&&(n.minX=r[0]),r[0]>n.maxX&&(n.maxX=r[0]),r[1]<n.minY&&(n.minY=r[1]),r[1]>n.maxY&&(n.maxY=r[1])}return n},removeAllBendMovers:function(){s.select(this.svg).selectAll(".bendMover").remove()},removeAllClusterMovers:function(){s.select(this.svg).selectAll(".clusterMover").remove()},moveNodeAndLinks:function(t,e,n,i){let r=this;s.select(r.svg).selectAll(".node").filter((function(e){return e.id===t})).attr("cx",(function(t){return t.x=e,e})).attr("cy",(function(t){return t.y=n,n})).attr("x",e-i.nodeWidth/2).attr("y",n-i.nodeHeight/2),s.select(r.svg).selectAll(".nodeLabel").filter((function(e){return e.id===t})).attr("transform",(function(){return"translate("+e+","+n+")"}));let o=[];s.select(r.svg).selectAll(".line").filter((function(e){return e.source===t||e.target===t})).attr("d",(function(i){return i.source===t&&(i.sx=e,i.sy=n),i.target===t&&(i.tx=e,i.ty=n),0===i.bends.length&&o.push(i.id),r.getPathForLine(i.sx,i.sy,i.bends,i.tx,i.ty,i.t_shape,i.source,i.target)}));for(let t=0;t<o.length;t++)s.select(r.svg).selectAll(".linkLabel").filter((function(e){return e.id===o[t]})).attr("transform",(function(t){return"translate("+(t.sx+t.tx)/2+","+(t.sy+t.ty)/2+")"}))},removeBendMoversForLink:function(t){s.select(this.svg).selectAll(".bendMover").filter((function(e){return e.id===t})).remove()},render:function(){if(0===this.links.length&&0===this.nodes.length)return;if(0===this.el.childNodes.length){let t="G"+Math.random().toString(16).slice(2);this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("id",t),this.svg.setAttribute("width",this.width),this.svg.setAttribute("height",this.height),this.el.appendChild(this.svg)}this.draw_graph(this.links);let t=this;setTimeout((function(){t.rescaleAllText()}),10)},constructForceLink(t,e,n,i){e.data([t]).enter().append("path").attr("class","line").attr("id",(function(t){return t.id})).attr("marker-end",(function(t){return t.arrow&&0===t.t_shape&&t.target!==t.source?"url(#endSquare)":t.arrow&&0!==t.t_shape&&t.target!==t.source?"url(#endCircle)":null})).attr("d",(function(t){return n.getPathForLine(t.sx,t.sy,t.bends,t.tx,t.ty,t.t_shape,t.source,t.target)})).attr("stroke",(function(t){return n.getColorStringFromJson(t.strokeColor)})).attr("stroke-width",(function(t){return t.strokeWidth})).attr("fill","none").on("click",(function(t,e){i||n.send({code:"linkClicked",id:e.id,altKey:t.altKey,ctrlKey:t.ctrlKey})}))},constructLink(t,e,n,i,r,s,o){e.data([t]).enter().append("path").attr("class","line").attr("id",(function(t){return t.id})).attr("marker-end",(function(t){return t.arrow&&0===t.t_shape&&t.source!==t.target?"url(#endSquare)":t.arrow&&0!==t.t_shape&&t.source!==t.target?"url(#endCircle)":null})).attr("d",(function(t){return r.getPathForLine(t.sx,t.sy,t.bends,t.tx,t.ty,t.t_shape,t.source,t.target)})).attr("stroke",(function(t){return r.getColorStringFromJson(t.strokeColor)})).attr("stroke-width",(function(t){return t.strokeWidth})).attr("fill","none"),n.data([t]).enter().append("text").attr("class","linkLabel").attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","black").attr("stroke-width",1).attr("stroke","white").attr("paint-order","stroke").attr("id",(function(t){return t.id})).text((function(t){return t.label})).style("font-size","0.5em").attr("transform",(function(t){return"translate("+t.label_x+","+t.label_y+")"})),o||i.data([t]).enter().append("path").attr("class","line").attr("id",(function(t){return t.id})).attr("d",(function(t){return r.getPathForLine(t.sx,t.sy,t.bends,t.tx,t.ty,t.t_shape,t.source,t.target)})).attr("stroke","transparent").attr("stroke-width",(function(t){return Math.max(t.strokeWidth,s)})).attr("fill","none").on("click",(function(t,e){r.send({code:"linkClicked",id:e.id,altKey:t.altKey,ctrlKey:t.ctrlKey})}))},constructNode(t,e,n,i,r){let s=e.data([t]).enter().append((function(t){return 0===t.shape?document.createElementNS("http://www.w3.org/2000/svg","rect"):document.createElementNS("http://www.w3.org/2000/svg","circle")})).attr("class","node").attr("width",(function(t){return t.nodeWidth})).attr("height",(function(t){return t.nodeHeight})).attr("x",(function(t){return t.x-t.nodeWidth/2})).attr("y",(function(t){return t.y-t.nodeHeight/2})).attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y})).attr("id",(function(t){return t.id})).attr("r",(function(t){return t.nodeHeight/2})).attr("fill",(function(t){return i.getColorStringFromJson(t.fillColor)})).attr("stroke",(function(t){return i.getColorStringFromJson(t.strokeColor)})).attr("stroke-width",(function(t){return t.strokeWidth})).on("click",(function(t,e){r||i.isNodeMovementEnabled||i.send({code:"nodeClicked",id:e.id,altKey:t.altKey,ctrlKey:t.ctrlKey})})),o=n.data([t]).enter().append("text").attr("class","nodeLabel").attr("text-anchor","middle").attr("dominant-baseline","central").attr("fill","black").attr("stroke-width",1).attr("stroke","white").attr("paint-order","stroke").attr("id",(function(t){return t.id})).text((function(t){return t.name})).style("font-size","1em").attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})).on("click",(function(t,e){r||i.isNodeMovementEnabled||i.send({code:"nodeClicked",id:e.id,altKey:t.altKey,ctrlKey:t.ctrlKey})}));i.isNodeMovementEnabled&&(s.call(i.node_drag_handler),o.call(i.node_drag_handler))},constructClusters:function(t,e=!0){let n=this.clusters[t];for(let t=0;t<n.children.length;t++)this.constructClusters(n.children[t],e);e&&this.recalculateClusterBoundingBox(n),this.calculateClusterSize(n),s.select(this.svg).selectAll(".cluster").filter((function(t){return t.id===n.id})).empty()?this.constructCluster(n,this.cluster_holder,this):this.updateCluster(n,!1)},recalculateClusterBoundingBox:function(t){let e=[];for(let n=0;n<t.nodes.length;n++)e.push(this.nodes[t.nodes[n]]);t.nodesBoundingBox=this.getBoundingBox(e)},calculateClusterSize:function(t){t.x=t.nodesBoundingBox.minX-10,t.y=t.nodesBoundingBox.minY-10,t.x2=t.nodesBoundingBox.maxX+10,t.y2=t.nodesBoundingBox.maxY+10;for(let e=0;e<t.children.length;e++)t.x=Math.min(t.x,this.clusters[t.children[e]].x),t.y=Math.min(t.y,this.clusters[t.children[e]].y),t.x2=Math.max(t.x2,this.clusters[t.children[e]].x2),t.y2=Math.max(t.y2,this.clusters[t.children[e]].y2);t.x=t.x-5,t.y=t.y-5,t.x2=t.x2+5,t.y2=t.y2+5},constructCluster:function(t,e,n){const i=s.line();e.data([t]).enter().append("path").attr("class","cluster").attr("id",(function(t){return t.id})).attr("d",(function(t){let e=[[t.x,t.y],[t.x2,t.y],[t.x2,t.y2],[t.x,t.y2],[t.x,t.y]];return i(e)})).attr("stroke",(function(t){return n.getColorStringFromJson(t.strokeColor)})).attr("stroke-width",(function(t){return t.strokeWidth})).attr("fill","none").on("click",(function(t,e){n.send({code:"clusterClicked",id:e.id,altKey:t.altKey,ctrlKey:t.ctrlKey})}))},getColorStringFromJson:t=>"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")",getPath:function(t,e,n,i){return"M"+t+","+e+"A30,20 -45,1,1 "+(n+1)+","+(i+1)},draw_graph(t){let e=this;const n=s.select(this.svg);n.on("click",(function(t){let n;n=void 0===t.path?"svg"===t.originalTarget.nodeName:"svg"===t.path[0].nodeName,e.send({code:"svgClicked",x:t.offsetX,y:t.offsetY,altKey:t.altKey,ctrlKey:t.ctrlKey,backgroundClicked:n})}));let i=Object.values(this.nodes),r=i.length>0?i[0].nodeWidth/2:0;s.select(this.svg).selectAll(".everything").remove(),this.g=n.append("g").attr("class","everything"),function(t){n.append("svg:defs").selectAll("marker").data(["endCircle"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",4*t/3+8).attr("refY",0).attr("markerWidth",8).attr("markerHeight",8).attr("orient","auto").attr("fill","black").append("svg:path").attr("d","M0,-5L10,0L0,5"),n.append("svg:defs").selectAll("marker").data(["endSquare"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 -5 10 10").attr("refX",10).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").attr("stroke","#000").attr("fill","#000").append("svg:path").attr("d","M0,-5L10,0L0,5").style("stroke-width","0.3px")}(r),this.cluster_holder=this.g.append("g").attr("class","cluster_holder").selectAll(".cluster"),null!=this.clusters&&this.isClusterGraph&&this.constructClusters(this.rootClusterId),this.line_holder=this.g.append("g").attr("class","line_holder").selectAll(".line"),this.line_click_holder=this.g.append("g").attr("class","line_click_holder").selectAll(".line"),this.line_text_holder=this.g.append("g").attr("class","line_text_holder").selectAll(".lineText");for(let n=0;n<t.length;n++)e.constructLink(t[n],this.line_holder,this.line_text_holder,this.line_click_holder,e,this.clickThickness,!1);this.bendMover_holder=this.g.append("g").attr("class","bendMover_holder").selectAll("bendMover"),e.node_drag_handler=s.drag().on("start",(function(t,n){const i=this.id;if(n.startX=n.x,n.startY=n.y,s.select(e.svg).selectAll(".node").filter((function(t){return t.id===i})).attr("stroke-width",(function(t){return t.strokeWidth+1})),e.forceDirected&&!t.active&&e.simulation.alphaTarget(.3).restart(),e.isClusterGraph){let t=e.clusters[n.clusterId],r=[];for(let n=0;n<t.nodes.length;n++)t.nodes[n]!==i&&r.push(e.nodes[t.nodes[n]]);t.bbWoutDragged=e.getBoundingBox(r)}})).on("drag",(function(t,n){let i=t.x,r=t.y;if(0!==e.gridSize&&(i=e.gridSize*Math.floor(t.x/e.gridSize+.5),r=e.gridSize*Math.floor(t.y/e.gridSize+.5)),e.forceDirected)return t.subject.fx=i,void(t.subject.fy=r);const o=this.id,l=s.line();if(e.moveNodeAndLinks(o,i,r,n),e.isClusterGraph){let i=e.clusters[n.clusterId];i.nodesBoundingBox.minX=Math.min(i.bbWoutDragged.minX,t.x),i.nodesBoundingBox.minY=Math.min(i.bbWoutDragged.minY,t.y),i.nodesBoundingBox.maxX=Math.max(i.bbWoutDragged.maxX,t.x),i.nodesBoundingBox.maxY=Math.max(i.bbWoutDragged.maxY,t.y);for(let t=i;null!==t&&(e.calculateClusterSize(t),s.select(e.svg).selectAll(".cluster").filter((function(e){return e.id===t.id})).attr("d",(function(t){let e=[[t.x,t.y],[t.x2,t.y],[t.x2,t.y2],[t.x,t.y2],[t.x,t.y]];return l(e)})),null!==t.parentId);t=e.clusters[t.parentId]);}})).on("end",(function(t,n){const i=this.id;s.select(e.svg).selectAll(".node").filter((function(t){return t.id===i})).attr("stroke-width",(function(t){return t.strokeWidth})),e.forceDirected&&!t.active&&e.simulation.alphaTarget(0),n.startX===t.x&&n.startY===t.y?(e.forceDirected&&(t.subject.fx=null,t.subject.fy=null),e.send({code:"nodeClicked",id:i,altKey:t.sourceEvent.altKey,ctrlKey:t.sourceEvent.ctrlKey})):(n.x=Math.round(t.x),n.y=Math.round(t.y),0!==e.gridSize&&(n.x=e.gridSize*Math.floor(t.x/e.gridSize+.5),n.y=e.gridSize*Math.floor(t.y/e.gridSize+.5)),e.send({code:"nodeMoved",id:this.id,x:n.x,y:n.y})),e.isClusterGraph&&delete e.clusters[n.clusterId].bbWoutDragged})),this.node_holder=this.g.append("g").attr("class","node_holder").selectAll(".node"),this.text_holder=this.g.append("g").attr("class","text_holder").selectAll(".nodeLabel");for(let t=0;t<i.length;t++)e.constructNode(i[t],this.node_holder,this.text_holder,e,!1);this.clusterMover_holder=this.g.append("g").attr("class","clusterMover_holder").selectAll("clusterMover"),this.readjustZoomLevel(this.getInitialTransform(r))},rescaleAllText(){s.select(this.svg).selectAll(".nodeLabel").style("font-size",this.adaptLabelFontSize)},rescaleTextById(t){s.select(this.svg).selectAll(".nodeLabel").filter((function(e){return e.id===t})).style("font-size",this.adaptLabelFontSize)},adaptLabelFontSize(t){let e,n,i,r;return e=2,n=t.nodeWidth,i=n-2,r=this.getComputedTextLength(),r<=i?"1em":i/r-.01+"em"},getPathForLine(t,e,n,i,r,o,l,d){if(l===d&&0===n.length)return this.getPath(t,e,i,r);const a=s.line();let c=[[t,e]].concat(n);if(0===o){let s=t,o=e;0!==n.length&&(s=n[n.length-1][0],o=n[n.length-1][1]);let l=this.nodes[d],h=this.pointOnRect(s,o,i-l.nodeWidth/2,r-l.nodeHeight/2,i+l.nodeWidth/2,r+l.nodeHeight/2,!1);return a(c)+"L"+h.x+","+h.y}return c=c.concat([[i,r]]),a(c)},pointOnRect(t,e,n,i,r,s,o){if(n<=t&&t<=r&&i<=e&&e<=s)return console.log("Point "+[t,e]+"cannot be inside the rectangle: "+[n,i]+" - "+[r,s]+"."),{x:(n+r)/2,y:(i+s)/2};const l=(n+r)/2,d=(i+s)/2,a=(d-e)/(l-t);if(t<=l){const r=a*(n-t)+e;if(i<=r&&r<=s)return{x:n,y:r}}if(t>=l){const n=a*(r-t)+e;if(i<=n&&n<=s)return{x:r,y:n}}if(e<=d){const s=(i-e)/a+t;if(n<=s&&s<=r)return{x:s,y:i}}if(e>=d){const i=(s-e)/a+t;if(n<=i&&i<=r)return{x:i,y:s}}throw"Cannot find intersection for "+[t,e]+" inside rectangle "+[n,i]+" - "+[r,s]+"."}});t.exports={WidgetModel:o,WidgetView:l}},338:(t,e,n)=>{"use strict";n.d(e,{Z:()=>s});var i=n(645),r=n.n(i)()((function(t){return t[1]}));r.push([t.id,"svg {\n    background: #edf0f5;\n}",""]);const s=r},645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var s=0;s<this.length;s++){var o=this[s][0];null!=o&&(r[o]=!0)}for(var l=0;l<t.length;l++){var d=[].concat(t[l]);i&&r[d[0]]||(n&&(d[2]?d[2]="".concat(n," and ").concat(d[2]):d[2]=n),e.push(d))}},e}},840:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>o});var i=n(379),r=n.n(i),s=n(338);r()(s.Z,{insert:"head",singleton:!1});const o=s.Z.locals||{}},379:(t,e,n)=>{"use strict";var i,r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),s=[];function o(t){for(var e=-1,n=0;n<s.length;n++)if(s[n].identifier===t){e=n;break}return e}function l(t,e){for(var n={},i=[],r=0;r<t.length;r++){var l=t[r],d=e.base?l[0]+e.base:l[0],a=n[d]||0,c="".concat(d," ").concat(a);n[d]=a+1;var h=o(c),u={css:l[1],media:l[2],sourceMap:l[3]};-1!==h?(s[h].references++,s[h].updater(u)):s.push({identifier:c,updater:m(u,e),references:1}),i.push(c)}return i}function d(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var s=n.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var o=r(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var a,c=(a=[],function(t,e){return a[t]=e,a.filter(Boolean).join("\n")});function h(t,e,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=c(e,r);else{var s=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(s,o[e]):t.appendChild(s)}}function u(t,e,n){var i=n.css,r=n.media,s=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var f=null,g=0;function m(t,e){var n,i,r;if(e.singleton){var s=g++;n=f||(f=d(e)),i=h.bind(null,n,s,!1),r=h.bind(null,n,s,!0)}else n=d(e),i=u.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var r=o(n[i]);s[r].references--}for(var d=l(t,e),a=0;a<n.length;a++){var c=o(n[a]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}n=d}}}},147:t=>{"use strict";t.exports={version:"0.1.0"}}}]);